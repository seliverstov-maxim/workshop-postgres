# Нормальные формы

##Процесс нормализации

Процесс нормализации основывается на концепции нормальных форм. Говорят, что отношение находится в определенной нормальной форме, если оно удовлетворяет заданному набору условий. Существует несколько нормальных форм, которые определены к настоящему времени. Первые три были описаны Э. Коддом, следующую формулу вывели Р. Бойс и Э. Кодд (НФБК – нормальная форма Бойса-Кодда), а четвёртую и пятую нормальные формы определил Р. Фейгин.

##Понятие функциональной зависимости

> Пусть R – это отношение. С одной стороны, оно имеет конкретное (постоянное) значение в данный момент времени. С другой стороны, это переменная, которая в каждый момент времени может принять некоторое новое значение.
Понятие ФЗ можно применить и к первому, и ко второму случаю. Однако мы будем рассматривать только второй случай, т.к. он больше соответствует реальности.

__Определение функциональной зависимости__. Пусть R – переменная отношения. X и Y – произвольные подмножества множества атрибутов R. Тогда Y функционально зависит от X, что в символическом виде записывается как X → Y (читается как «X функционально определяет Y») тогда и только тогда, когда для любого допустимого значения R каждое значение X связано точно с одним значением Y.

> *Здесь X называют детерминантом ФЗ, а Y – зависимой частью ФЗ.*

__Пример__: Пусть R – это отношение Students. X – код студента, а Y – множество всех атрибутов студента. Тогда X → Y, т.к. X представляет собой первичный ключ, который уникально идентифицирует запись в таблице Students.

Такое утверждение будет верно и для более общего случая: если X – это потенциальный ключ, то множество всех атрибутов R всегда функционально зависит от X. Однако следует иметь в виду, что если в R имеется ФЗ, левая часть которой не включает потенциальный ключ, то R обладает избыточностью, что затрудняет обеспечение целостности данных и занимает лишние ресурсы системы. Если ни один атрибут не может быть опущен из левой части, то такая функциональная зависимость называется неприводимой (точнее, неприводимой слева).

__Пример__: 

`{StudentID, FirstName, LastName, MiddleName} → {BirthDate}` – приводимая ФЗ.

`{StudentID} → {BirthDate}` – неприводимая ФЗ.

Множество функциональных зависимостей называется неприводимым тогда и только тогда, когда оно обладает всеми тремя перечисленными ниже свойствами:
* Зависимая часть каждой функциональной зависимости содержит только один атрибут.
* Детерминант каждой функциональной зависимости является неприводимым.
* Ни одна функциональная зависимость из множества не может быть удалена без потери информации о связях.

## Декомпозиция без потерь

Существенным аспектом процедуры нормализации является декомпозиция – разбиение отношения на производные. При этом такое разбиение не должно повлечь за собой потерю информации. Если отношение разбито на два без потерь, то это разбиение можно назвать обратимым, т.е. можно произвести обратное соединение.

## Первая нормальная форма
> Переменная отношения находится в первой нормальной форме тогда и только тогда, когда в любом допустимом значении отношения каждый его кортеж содержит только скалярные значения для каждого из атрибутов, т.е. значения всех полей отношения должны быть логически неделимы.

Кортеж, Переменная отношения - это записи в таблице.
Атрибут - это колонка в записи.

Рассматриваемая таблица должна удовлетворять следующим пяти условиям:
* Нет упорядочивания строк сверху вниз (другими словами, порядок строк не несет в себе никакой информации).
* Нет упорядочивания столбцов слева направо (другими словами, порядок столбцов не несет в себе никакой информации).
* Нет повторяющихся строк.
* Каждое пересечение строки и столбца содержит ровно одно значение из соответствующего домена (и больше ничего).
* Все столбцы являются обычными

Не соответствует

category|products
---|---
books|bookname1, bookname2
toys|toy1, toy2

Соответствует

category|products
---|---
books|bookname1
books|bookname2
toys|toy1
toys|toy2

## Вторая нормальная форма
> Переменная отношения находится во второй нормальной форме тогда и только тогда, когда она находится в первой нормальной форме и каждый неключевой атрибут неприводимо зависит от её потенциального ключа.

Не приводимо, значти что из ключа нельзя выкинуть колонки сохранив его уникальность.

Потенциальный ключ - это любой ключ котороый можно определить в таблице (уникальная колонка или их набор).

Неключевой атрибут - это атрибут, не входящий в состав никакого потенциального ключа.

Обычными словами в таблице не должно быть набора неключевых полей одни из которох зависят от ключа целиком, а другие от какой-то части ключа.

Например: У нас в таблице есть атрибуты`{id пользоывателя, фамилия, имя, отчество, предмет, среняя оценка по предмету}`, часть из которых: `{Фамилия, Имя, Отчество}` зависят только от ключа `{id пользователя}`, а другая часть: `{средняя оценка по предмету}` зависит от комбинации ключей: `{id пользователя, предмет}`. Таким образом таблица не соответствует 2ой нормальной форме.

__students__:

student_id|name|surname|course|avg score
---|---|---|---|---
1|Коля|Петров|english|4
2|Вася|Иванов|spanish|3
3|Женя|Карпов|english|5
4|Петя|Карпов|spanish|4

Первичным ключом здесь будет `{student_id, course}`, тогда проанализируем ФЗ этого отношения, где детерминантом является первичный ключ, а в правой части неключевой атрибут. Рассмотрим следующую ФЗ:

`{student_id, course} → {name}`

Очевидно, что она является приводимой, т.к. фамилия зависит только от `student_id`, а значит существует ФЗ: `{student_id} → {name}`. Следовательно данное отношение не находится во 2НФ. Произведем декомпозицию исходного отношения на следующие два.

__students__:

student_id|name|surname
---|---|---
1|Коля|Петров
2|Вася|Иванов
3|Женя|Карпов
4|Петя|Карпов

__scores__:

user_id|course|avg score
---|---|---
1|english|4
2|spanish|3
3|english|5
4|spanish|4

## Треться нормальная форма

> Переменная отношения R находится в 3NF тогда и только тогда, когда выполняются следующие условия:
* R находится во второй нормальной форме.
* все неключевые артибуты взаимно функционально независимы.

Рассмотрим следующее отношение __students__:

student_id|name|surname|group_id|supervisor
---|---|---|---|---
1|Коля|Петров|1|Путин
2|Вася|Иванов|1|Путин
3|Женя|Карпов|2|Зюганов
4|Петя|Карпов|3|Жириновский

Так как существуют ФЗ: `student_id → group_id` и `group_id → supervisor`, то атрибут `supervisor` транзитивно зависит от первичного ключа `student_id`. Следовательно отношение не находится в 3НФ. Приведем отношение к 3НФ.

Students:

student_id|name|surname|group_id
---|---|---|---
1|Коля|Петров|1
2|Вася|Иванов|1
3|Женя|Карпов|2
4|Петя|Карпов|3

Groups:

group_id|supervisor
---|---
1|Путин
2|Зюганов
3|Жириновский

## Форма Бойса Кодда

> Переменная отношения находится в BCNF когда каждая её нетривиальная и неприводимая слева функциональная зависимость имеет в качестве своего детерминанта некоторый потенциальный ключ

Важным отличием от 3 и 2 нормальных форм состоит в том, что в них правила налагались на не ключевые атрибуты, т.е. те которые не не участвуют ни в одном потенциальном ключе.

не соответствует BCNF:

user_id|passport|course|score
---|---|---|---
1|7309 111222|english|5
1|7309 111222|spanish|5
2|7309 343344|russian|5
3|7309 123445|english|5

Тут определено два потенциальных ключа `user_id course` и `passport course`. Детеминант функциональной зависимости `user_id → passport` не является потенциальным ключем, а значит отношение не соответствует BCNF.

соответствует

user_id|passport
---|---|---|---
1|7309 111222
2|7309 343344
3|7309 123445

user_id|course|score
---|---|---
1|english|5
1|spanish|5
2|russian|5
3|english|5

## Четвертая нормальная форма
## Пятая нормальная форма
## Доменно-ключевая нормальная форма 
## Шестая нормальная форма
